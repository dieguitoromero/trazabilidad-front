<div class="tracking-back-row" *ngIf="invoice">
  <button class="back-badge" (click)="volver()">
    <span class="arrow">‚Üê</span>
    <span class="text">Volver</span>
  </button>
</div>

<div class="box-container" *ngIf="displaySteps.length">
  <!-- <div class="stepper-progress" *ngIf="completedCount() > 0"><p class="document-info" *ngIf="getDocumentString() as docString">{{ docString }}</p>
    {{completedCount()}} de {{displaySteps.length}} pasos
  </div> -->
  <div class="d-flex stepper-view-container mobile-vertical flex-column "
    [ngClass]="{'justify-content-md-center flex-md-row': true, 'vertical': false}">
    <div class="fadingEffect" *ngIf="displaySteps && displaySteps.length > 0"></div>
    <ng-container *ngFor="let step of displaySteps; let i = index;">
      <div class="step-container d-flex" [ngClass]="{'d-md-block': true}">
        <div class="step-title order-1" [ngClass]="{'order-2': false, 'beginning': i <= 0, 'order-md-0': true}"
          [ngStyle]="{ 'color': step.title.color }">
          <p class="title" [matBadge]="numberOfItemsOnStatus(step.title, i)" matBadgeOverlap="false"
            matBadgeColor="warn" [matBadgeHidden]="numberOfItemsOnStatus(step.title, i) <= 0 || isDeliveredTitle(step.title?.text)">{{step.title.text}}</p>
          <p class="sub-title d-block d-md-none" *ngIf="step.icon !== 'pending'">{{ step.description || '-' }}</p>
          <span class="date d-block d-md-none">{{ step.date ? (step.date | date: 'dd-MM-yyyy') : '-' }}</span>
        </div>

        <div class="step d-block order-0"
          [ngClass]="{'order-1': false, 'beginning': i <= 0, 'd-md-flex order-md-1': true,'in-progress': isStepInProgress(step, i), 'completed': isStepCompleted(step), 'last': isLastStepCompleted(i)}">
          <div class="step-separator from align-self-center flex-grow-1" *ngIf="i > 0 || true"
            [ngClass]="{ 'beginning': i <= 0, 'd-none d-md-block': (i == 0)}"></div>
          <div class="icon-wrapper">
            <ng-container *ngIf="step.icon !== 'pending'; else pendingIcon">
              <img class="icon" [src]="step.icon" alt="step icon" />
            </ng-container>
            <ng-template #pendingIcon>
              <div class="icon pending"></div>
            </ng-template>
            <span class="product-count-badge" *ngIf="showDeliveredBadge(step)">{{ productCount() }}</span>
          </div>
          <div class="step-separator to align-self-center flex-grow-1"
            *ngIf="i < (displaySteps ? displaySteps.length - 1 : 0) || true"
            [ngClass]="{ 'end': i >= (displaySteps ? displaySteps.length - 1 : 0), 'd-none d-md-block': i >= (displaySteps ? displaySteps.length - 1 : 0)}">
          </div>
        </div>

        <div class="step-details d-none d-md-block">
          <div class="alcanzado-text" *ngIf="step.icon !== 'pending'">{{ step.description || '-' }}</div>
          <span class="date">{{ step.date ? (step.date | date: 'dd-MM-yyyy') : '-' }}</span>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- Card: Resumen de tu compra -->
<div class="box-container" *ngIf="invoice">
  <div class="purchase-summary-card">
    <h3>{{ purchaseSummaryTitle() }}</h3>
    <div class="tipo-entrega-row">
      <div class="icon-col"
        [ngClass]="{'tienda': resumenTipoEntrega() === 'Retiro en Tienda', 'domicilio': resumenTipoEntrega() !== 'Retiro en Tienda'}">
      </div>
      <div class="data-col">
        <p class="tipo">{{resumenTipoEntrega()}}</p>
        <p class="direccion" *ngIf="direccionEntrega()">{{direccionEntrega()}}</p>
        <p class="fecha-compra" *ngIf="resumenFechaRetiro()">Retira a partir del {{ resumenFechaRetiro() }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Card: Resumen de tu pedido -->
<div class="box-container" #orderDetailsView>
  <div class="pedido-summary-card">
    <h3>Resumen de tu pedido</h3>
    <h4 class="sub">{{ productSubtitle() }}</h4>
    <div class="sub-line"></div>
    <div class="productos-wrapper" *ngIf="invoice?.orderProducts?.length">
      <div class="productos-list">
        <div class="producto-item" *ngFor="let p of invoice?.orderProducts; let i = index">
          <div class="left-block">
            <div class="img-col">
              <img class="producto-img" [src]="p.image || 'assets/not-image.jpg'" (error)="onImgError($event)"
                alt="producto" />
            </div>
            <div class="info-col">
              <p class="nombre">{{ p.description }}</p>
              <p class="cantidad">{{ p.quantity === 1 ? '1 UNIDAD' : (p.quantity + ' UNIDADES') }}</p>
            </div>
          </div>
          <div class="right-block" *ngIf="p.code">
            <span class="sku-inline">SKU {{ p.code }}</span>
          </div>
          <div class="row-separator" *ngIf="i < ((invoice?.orderProducts?.length || 0) - 1)"></div>
        </div>
      </div>
    </div>
  </div>
</div>