<!-- Boton volver cuando estamos en vista de detalle -->
<div class="back-button-container" *ngIf="isDetailView">
    <button class="back-button" (click)="goBack()">
        <span class="back-arrow">&larr;</span> Volver
    </button>
</div>

<!-- Header con informacion del documento -->
<div class="document-header" *ngIf="invoice && isDetailView">
    <h2 class="document-title">Detalle de documento</h2>
    <p class="document-number">Documento NÂ°: {{ getFormattedDocumentNumber() }}</p>
</div>

<!-- Buscador - solo mostrar si no es vista de detalle -->
<app-tracking-search-box *ngIf="showSearchBox" (search)="onSearch($event)"
    [searchModel]="searchModel"></app-tracking-search-box>

<!-- Loading state -->
<div class="loading-container" *ngIf="working">
    <div class="loading-spinner"></div>
</div>

<!-- Error state -->
<div class="error-container" *ngIf="hasError && !working">
    <p>Ocurrio un error al cargar la informacion. Por favor intente nuevamente.</p>
</div>

<!-- Contenido principal del tracking -->
<div class="tracking-content" *ngIf="invoice && !working">
    <!-- Timeline principal de tracking -->
    <div class="box-container">
        <app-tracking-stepper-view [steps]="invoice?.trackingSteps"
            [orderDetails]="stepperOrderDetails"></app-tracking-stepper-view>
    </div>

    <!-- Detalles de entrega/pickup - mismo componente que en listado para consistencia -->
    <div class="box-container">
        <app-purchase-summary [pickup]="invoice?.pickup"></app-purchase-summary>
    </div>

    <!-- Detalles de productos si existen -->
    <div class="box-container" *ngIf="invoice?.hasProductDetails">
        <app-tracking-order-details [orderDetails]="invoice?.orderProducts" [isBox]="true"></app-tracking-order-details>
    </div>

    <!-- Seccion de Dimensionado (Machinable) -->
    <div class="box-container no-padding machinable-section" #trackingStepperView>
        <ng-container *ngFor="let step of invoice?.trackingSteps">
            <app-tracking-machinable-process
                *ngIf="step.machinable && step.machinable.orders && step.machinable.orders.length > 0"
                [machinableProcess]="step.machinable">
            </app-tracking-machinable-process>
        </ng-container>
    </div>
</div>